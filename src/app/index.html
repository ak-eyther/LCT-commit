<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCT Success Matrix Tracker</title>
    <link rel="stylesheet" href="../assets/css/design-tokens.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--muted);
            color: var(--text);
            line-height: var(--leading-normal);
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: var(--text-3xl);
            font-weight: var(--font-semibold);
            color: var(--primary);
            margin-bottom: var(--spacing-1);
        }

        .header p {
            font-size: var(--text-base);
            color: var(--muted-fg);
        }

        .top-nav {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: var(--spacing-4) var(--spacing-6);
            display: flex;
            gap: var(--spacing-6);
            align-items: center;
            margin-bottom: 0;
        }

        .top-nav a {
            color: var(--muted-fg);
            text-decoration: none;
            font-size: var(--text-base);
            font-weight: var(--font-medium);
            transition: color var(--transition-fast);
        }

        .top-nav a:hover {
            color: var(--primary);
        }

        .top-nav a.active {
            color: var(--primary);
            border-bottom: 2px solid var(--accent);
        }

        .nav {
            display: flex;
            gap: var(--spacing-1);
            margin-bottom: var(--spacing-5);
            border-bottom: 1px solid var(--border);
        }

        .nav-item {
            padding: var(--spacing-2) var(--spacing-4);
            border: none;
            background: transparent;
            font-size: var(--text-base);
            font-weight: var(--font-medium);
            cursor: pointer;
            color: var(--muted-fg);
            border-bottom: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .nav-item:hover {
            color: var(--primary);
        }

        .nav-item.active {
            color: var(--primary);
            border-bottom-color: var(--accent);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--surface);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn:hover {
            background: var(--muted);
            border-color: var(--muted-fg);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        /* Dashboard Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-4);
            text-align: center;
        }

        .stat-card .label {
            font-size: var(--text-xs);
            color: var(--muted-fg);
            margin-bottom: var(--spacing-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .number {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--spacing-1);
        }

        .stat-card .subtext {
            font-size: 11px;
            color: var(--muted-fg);
            opacity: 0.8;
        }

        .stat-card.total {
            border-left: 3px solid var(--primary);
        }
        .stat-card.total .number { color: var(--primary); }

        .stat-card.completed {
            background: #f0fdf4;
            border-color: #bbf7d0;
            border-left: 3px solid var(--success);
        }
        .stat-card.completed .number { color: var(--success); }

        .stat-card.progress {
            background: #fff5f0;
            border-color: #fed7c4;
            border-left: 3px solid var(--accent);
        }
        .stat-card.progress .number { color: var(--accent); }

        .stat-card.planned {
            background: #fffbeb;
            border-color: #fde68a;
            border-left: 3px solid var(--warning);
        }
        .stat-card.planned .number { color: var(--warning); }

        .stat-card.notstarted {
            background: var(--muted);
            border-color: var(--border);
            border-left: 3px solid var(--info);
        }
        .stat-card.notstarted .number { color: var(--info); }

        .stat-card.critical {
            background: #fef2f2;
            border-color: #fecaca;
            border-left: 3px solid var(--error);
        }
        .stat-card.critical .number { color: var(--error); }

        .stat-card.percentage {
            background: #fff5f0;
            border-color: #fed7c4;
            border-left: 3px solid var(--accent);
        }
        .stat-card.percentage .number { color: var(--accent); }

        .dashboard-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-5);
            margin-bottom: var(--spacing-5);
        }

        .dashboard-section h3 {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            margin-bottom: var(--spacing-4);
            color: var(--primary);
        }

        .progress-bar-container {
            margin-bottom: 16px;
        }

        .progress-bar-container .label {
            display: flex;
            justify-content: space-between;
            font-size: var(--text-sm);
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 8px;
            background: var(--muted);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--success);
            transition: width var(--transition-slow);
        }

        .priority-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .priority-item {
            padding: var(--spacing-3);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            text-align: center;
        }

        .priority-item .count {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            margin-bottom: var(--spacing-1);
        }

        .priority-item .label {
            font-size: var(--text-xs);
            color: var(--muted-fg);
        }

        .section-breakdown {
            display: grid;
            gap: 12px;
        }

        .section-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-3);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
        }

        .section-item .name {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        .section-item .stats {
            display: flex;
            gap: var(--spacing-4);
            font-size: var(--text-xs);
            color: var(--muted-fg);
        }

        /* Checklist Styles */
        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--surface);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            cursor: pointer;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: var(--text-base);
            font-weight: var(--font-semibold);
            color: var(--primary);
            margin-bottom: var(--spacing-3);
            padding-bottom: var(--spacing-2);
            border-bottom: 1px solid var(--border);
        }

        .item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-4);
            margin-bottom: var(--spacing-3);
        }

        .item.critical {
            border-left: 3px solid var(--error);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .item-title {
            font-size: var(--text-base);
            font-weight: var(--font-medium);
            color: var(--primary);
            flex: 1;
        }

        .badges {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .badge {
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: var(--font-medium);
            border: 1px solid;
        }

        .badge-critical {
            background: #fef2f2;
            color: #991b1b;
            border-color: #fecaca;
        }

        .badge-high {
            background: #fef3c7;
            color: #92400e;
            border-color: #fde68a;
        }

        .badge-medium {
            background: #dbeafe;
            color: #1e40af;
            border-color: #bfdbfe;
        }

        .badge-low {
            background: var(--muted);
            color: var(--text-secondary);
            border-color: var(--border);
        }

        .explain-toggle {
            font-size: var(--text-sm);
            color: var(--muted-fg);
            cursor: pointer;
            user-select: none;
            margin-bottom: var(--spacing-3);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-1);
        }

        .explain-toggle:hover {
            color: var(--primary);
        }

        .explanation {
            display: none;
            padding: var(--spacing-3);
            background: var(--muted);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-3);
            line-height: var(--leading-relaxed);
        }

        .explanation.show {
            display: block;
        }

        .explanation strong {
            color: var(--primary);
        }

        .example {
            margin-top: var(--spacing-2);
            padding: var(--spacing-2);
            background: var(--surface);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            border: 1px solid var(--border);
        }

        .form-row {
            display: grid;
            grid-template-columns: 140px 1fr 120px;
            gap: 8px;
            margin-bottom: 8px;
        }

        .form-full {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: var(--text-xs);
            font-weight: var(--font-medium);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-1);
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            background: var(--surface);
            font-family: var(--font-sans);
        }

        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(217, 119, 87, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 50px;
        }

        .hidden {
            display: none !important;
        }

        .toast {
            position: fixed;
            bottom: var(--spacing-5);
            right: var(--spacing-5);
            background: var(--primary);
            color: white;
            padding: 10px var(--spacing-4);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            display: none;
            box-shadow: var(--shadow-lg);
        }

        .toast.show {
            display: block;
            animation: slideIn 0.2s;
        }

        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .form-full {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <a href="index.html" class="active">Dashboard</a>
        <a href="team-structure-v2.html">Team Structure</a>
        <a href="reports.html">Reports</a>
        <a href="documentation.html">Documentation</a>
        <a href="settings.html">Settings</a>
    </nav>

    <div class="container">
        <div class="header">
            <h1>LCT Success Matrix Tracker</h1>
            <p>31 evaluation criteria with detailed explanations</p>
        </div>

        <div class="nav">
            <button class="nav-item active" onclick="switchPage('dashboard')">Dashboard</button>
            <button class="nav-item" onclick="switchPage('checklist')">Checklist</button>
        </div>

        <!-- DASHBOARD PAGE -->
        <div id="dashboard-page" class="page active">
            <div class="controls">
                <button class="btn btn-primary" onclick="saveData()">Save</button>
                <button class="btn" onclick="exportJSON()">Export JSON</button>
                <button class="btn" onclick="exportCSV()">Export CSV</button>
            </div>

            <div class="stats-grid" id="stats-cards"></div>

            <div class="dashboard-section">
                <h3>Overall Progress</h3>
                <div class="progress-bar-container">
                    <div class="label">
                        <span>Completion</span>
                        <span id="progress-percentage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>By Priority</h3>
                <div class="priority-grid" id="priority-breakdown"></div>
            </div>

            <div class="dashboard-section">
                <h3>By Section</h3>
                <div class="section-breakdown" id="section-breakdown"></div>
            </div>
        </div>

        <!-- CHECKLIST PAGE -->
        <div id="checklist-page" class="page">
            <div class="controls">
                <button class="btn btn-primary" onclick="saveData()">Save</button>
                <button class="btn" onclick="exportJSON()">Export JSON</button>
                <button class="btn" onclick="exportCSV()">Export CSV</button>
            </div>

            <div class="filters">
                <button class="filter-btn active" onclick="filterItems('all')">All (31)</button>
                <button class="filter-btn" onclick="filterItems('CRITICAL')">Critical (4)</button>
                <button class="filter-btn" onclick="filterItems('Not Started')">Not Started</button>
                <button class="filter-btn" onclick="filterItems('In Progress')">In Progress</button>
                <button class="filter-btn" onclick="filterItems('Completed')">Completed</button>
            </div>

            <div id="checklist-content"></div>
        </div>
    </div>

    <div class="toast" id="toast">Saved</div>

    <script>
        const checklistData = [
            {
                section: "1. Clinical Accuracy",
                items: [
                    {
                        id: 1,
                        criteria: "ICD matches the billed service",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "Validate that ICD-10 diagnosis codes match billed services. If diagnosed with malaria (B50), services should include malaria-related tests and medications.",
                        example: "‚ùå Diagnosis: Common cold (J00) + Malaria test\n‚úÖ Diagnosis: Malaria (B50) + Malarial test + antimalarial drugs"
                    },
                    {
                        id: 2,
                        criteria: "Service-Diagnosis consistency (including pre-auth)",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "Cross-reference claim services with diagnosis AND pre-authorization clinical info. Ensure services match approved treatment plan.",
                        example: "Pre-auth: Routine diabetes management\nClaim: Emergency diabetic crisis treatment\nüö® Flag: Service escalation without new pre-auth"
                    },
                    {
                        id: 3,
                        criteria: "Medical notes completeness",
                        target: "100%",
                        priority: "High",
                        explanation: "Complete documentation from pre-auth AND final billing required: pre-auth form, consultation notes, lab reports, prescription, separate claim form.",
                        example: "Required: Pre-auth form + Doctor notes + Lab reports + Prescription + Claim form\n‚ùå Incomplete: Missing lab reports"
                    }
                ]
            },
            {
                section: "2. Financial & Policy Compliance",
                items: [
                    {
                        id: 4,
                        criteria: "Invoice amount precedence (LCT ‚Üí ETIMS ‚Üí Document)",
                        target: "100%",
                        priority: "CRITICAL",
                        explanation: "Priority order: (1) LCT amount, (2) ETIMS, (3) Document. If ETIMS < LCT, flag as Query. Catches under-billing and data errors.",
                        example: "LCT: 1,700 | ETIMS: 1,500 | Document: 3,370\nüö® ETIMS < LCT ‚Üí Query\nUse LCT amount (1,700) as baseline"
                    },
                    {
                        id: 5,
                        criteria: "Invoice date within policy period",
                        target: "100%",
                        priority: "Medium",
                        explanation: "Invoice date must fall within member's active policy. OPD: LCT and document dates should match (¬±1 day tolerance).",
                        example: "Policy: Dec 1, 2024 - Nov 30, 2025\nInvoice: June 16, 2025 ‚úÖ\nInvoice: Dec 5, 2023 ‚ùå"
                    },
                    {
                        id: 6,
                        criteria: "Preauthorization linkage accuracy",
                        target: "‚â•98%",
                        priority: "High",
                        explanation: "Link pre-auth to final claim, deduct pre-auth amount. Prevents double payment.",
                        example: "Pre-auth: 5,000 | Final claim: 8,000\n‚úÖ Balance due: 3,000 (not 8,000)"
                    },
                    {
                        id: 7,
                        criteria: "Benefit-level savings tracking",
                        target: "100%",
                        priority: "High",
                        explanation: "Track savings per benefit category (Inpatient, Maternity, Optical, Dental) to identify fraud patterns.",
                        example: "Optical: Billed 10k ‚Üí Approved 10k (0% saving)\nOutpatient: Billed 12,959 ‚Üí Approved 11k (15% saving)"
                    },
                    {
                        id: 8,
                        criteria: "Service-level savings tracking",
                        target: "100%",
                        priority: "High",
                        explanation: "Track savings by service type (Pharmacy, Lab, Imaging) per invoice to identify high-fraud areas.",
                        example: "Consultation: 600 ‚Üí 600 (0%)\nMedications: 1,630 ‚Üí 1,400 (14%)\nLabs: 1,140 ‚Üí 1,000 (12%)"
                    },
                    {
                        id: 9,
                        criteria: "Tariff and price validation",
                        target: "‚â•98%",
                        priority: "CRITICAL",
                        explanation: "Compare billed amounts against approved tariff list. Auto-deduct overcharges.",
                        example: "Full Haemogram: Provider 1,200 | Tariff 840\nüö® Overcharge: 360 (30%)\n‚úÖ Approve: 840"
                    }
                ]
            },
            {
                section: "3. Fraud & Duplication Safeguards",
                items: [
                    {
                        id: 10,
                        criteria: "Duplicate visit detection",
                        target: "100%",
                        priority: "High",
                        explanation: "Flag multiple visits same day, same diagnosis, same/different providers.",
                        example: "June 16: Bliss Healthcare - Malaria\nJune 16: Oasis Hospital - Malaria\nüö® Duplicate visit"
                    },
                    {
                        id: 11,
                        criteria: "Repeated service detection",
                        target: "100%",
                        priority: "CRITICAL",
                        explanation: "Detect identical tests/medications multiple times without clinical justification.",
                        example: "June 16: Full Haemogram at Provider A\nJune 18: Full Haemogram at Provider B\nJune 20: Full Haemogram at Provider C\nüö® 3 identical tests in 5 days"
                    },
                    {
                        id: 12,
                        criteria: "Invoice number format consistency",
                        target: "100%",
                        priority: "Medium",
                        explanation: "Validate invoice numbers match between LCT and documents.",
                        example: "LCT: CB-109764-25\nDoc: CB109764/25\nüö® Format mismatch"
                    },
                    {
                        id: 13,
                        criteria: "Remove non-alphanumeric characters",
                        target: "100%",
                        priority: "Low",
                        explanation: "Clean invoice numbers before comparison (remove dashes, slashes, spaces).",
                        example: "CB-109764-25 ‚Üí CB10976425\nCB/109764/25 ‚Üí CB10976425 ‚úÖ Match"
                    },
                    {
                        id: 14,
                        criteria: "Member visit frequency anomaly",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "Flag abnormal visit frequency vs historical pattern and scheme averages. Trigger: >5 visits/30 days or >10 visits/90 days.",
                        example: "Member avg: 2 visits/month\nLast 30 days: 8 visits\nüö® 400% increase"
                    },
                    {
                        id: 15,
                        criteria: "Cross-provider duplicate service",
                        target: "100%",
                        priority: "CRITICAL",
                        explanation: "Detect same service from different providers within 7 days. Major fraud indicator.",
                        example: "June 16: Malaria test at Bliss (300)\nJune 18: Malaria test at Oasis (300)\nüö® Duplicate ‚Üí Reject 2nd claim"
                    },
                    {
                        id: 16,
                        criteria: "Medication refill pattern analysis",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "Detect early refills (>20% before expected), duplicate prescriptions, excessive quantities.",
                        example: "Day 1: 30 paracetamol (30-day supply)\nDay 2: 10 more paracetamol\nüö® 133% of normal dose in 2 days"
                    },
                    {
                        id: 17,
                        criteria: "Provider billing pattern anomalies",
                        target: "‚â•90%",
                        priority: "High",
                        explanation: "Flag providers >30% above peer average or sudden spikes (>50% increase).",
                        example: "Provider: 1,200 consultation\nScheme avg: 600\nüö® 100% above average"
                    },
                    {
                        id: 18,
                        criteria: "Benefit exhaustion velocity",
                        target: "‚â•95%",
                        priority: "Medium",
                        explanation: "Flag members exhausting >80% benefit in first 90 days or >50% in first 30 days.",
                        example: "Annual benefit: 200k\nMonth 1: 170k used (85%)\nüö® Abnormal velocity"
                    },
                    {
                        id: 19,
                        criteria: "Family unit fraud pattern",
                        target: "‚â•90%",
                        priority: "Medium",
                        explanation: "Detect coordinated fraud: multiple family members, same provider, same day, maxing benefits.",
                        example: "4 family members on June 16:\nAll at Optex Opticians\nAll claim 30k optical\nüö® Coordinated fraud: 120k"
                    },
                    {
                        id: 20,
                        criteria: "Geographic location mismatch",
                        target: "‚â•95%",
                        priority: "Medium",
                        explanation: "Flag claims >50km from member's registered address or impossible travel patterns.",
                        example: "Member: Kisii\nProvider: Nairobi (350km)\n‚ùì Why travel for basic OPD?"
                    },
                    {
                        id: 21,
                        criteria: "Diagnosis-service historical validation",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "Cross-reference with member's medical history. Flag contradictions or impossible scenarios.",
                        example: "March: HbA1c = 4.8 (not diabetic)\nJune: Diabetes medications\nüö® No diabetes diagnosis in history"
                    },
                    {
                        id: 22,
                        criteria: "High-cost service clustering",
                        target: "‚â•90%",
                        priority: "High",
                        explanation: "Flag multiple expensive tests (MRI, CT, specialized labs) without diagnosis severity justification.",
                        example: "2 weeks: MRI 25k + CT 18k + Ultrasound 8k + Check 12k = 63k\nDiagnosis: Common headache\nüö® Excessive for minor condition"
                    },
                    {
                        id: 23,
                        criteria: "Provider rejection rate trending",
                        target: "‚â•85%",
                        priority: "Medium",
                        explanation: "Track providers with >25% rejection rate vs scheme average <15%. Monitor 3-month trends.",
                        example: "Provider: 38% rejection\nScheme avg: 15%\nüö® 2.5x above average"
                    },
                    {
                        id: 24,
                        criteria: "Claim threshold manipulation",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "Detect deliberate splitting or billing just under approval thresholds to avoid scrutiny.",
                        example: "Threshold: 5,000 requires extra docs\nClaims: 4,950, 4,900, 4,850, 4,920\nüö® All cluster below 5k threshold"
                    },
                    {
                        id: 25,
                        criteria: "Seasonal/temporal fraud patterns",
                        target: "‚â•85%",
                        priority: "Medium",
                        explanation: "Detect end-of-period spikes, unusual timing patterns (specific days/times), benefit rushing.",
                        example: "Normal: 2-3 claims/month\nNovember: 15 claims\nüö® End-of-period benefit rushing"
                    },
                    {
                        id: 26,
                        criteria: "Chronic condition consistency",
                        target: "‚â•95%",
                        priority: "High",
                        explanation: "For chronic conditions (diabetes, hypertension), validate treatment aligns with severity and history.",
                        example: "Diabetes (mild, HbA1c 6.2)\nClaimed: Insulin pump\nüö® Treatment-severity mismatch"
                    },
                    {
                        id: 27,
                        criteria: "Provider service scope validation",
                        target: "‚â•90%",
                        priority: "Medium",
                        explanation: "Verify providers only bill for services within registered capabilities and equipment.",
                        example: "Small clinic\nClaimed: MRI scan + cardiac catheterization\nüö® Beyond provider capabilities"
                    }
                ]
            },
            {
                section: "4. Vetting Completeness",
                items: [
                    {
                        id: 28,
                        criteria: "100% vetting completeness per visit",
                        target: "100%",
                        priority: "High",
                        explanation: "Every invoice must receive vetting decision (Approve/Reject/Query). Track per invoice ID.",
                        example: "Visit V-001: 3 invoices\n‚Ä¢ Invoice 1: Vetted ‚úÖ\n‚Ä¢ Invoice 2: Vetted ‚úÖ\n‚Ä¢ Invoice 3: Not vetted ‚ùå\n66% completion ‚Üí Fail"
                    },
                    {
                        id: 29,
                        criteria: "Query criteria definition",
                        target: "100%",
                        priority: "High",
                        explanation: "Define Query triggers: (1) Missing docs, (2) Incomplete claim form, (3) Pre-auth form used as claim form, (4) Insufficient clinical info.",
                        example: "Triggers:\n‚Ä¢ Malaria diagnosis but no lab report ‚Üí Query\n‚Ä¢ Pre-auth form used as claim ‚Üí Query\n‚Ä¢ Empty diagnosis field ‚Üí Query"
                    }
                ]
            },
            {
                section: "5. Process Efficiency",
                items: [
                    {
                        id: 30,
                        criteria: "Vetting TAT",
                        target: "<2 mins",
                        priority: "Medium",
                        explanation: "Measure AI adjudication time per claim. Target <2 mins vs manual 15-30 mins.",
                        example: "AI: 47 seconds ‚úÖ\nManual: 22 minutes\nEfficiency: 96.4% faster"
                    },
                    {
                        id: 31,
                        criteria: "Cost savings by provider/scheme",
                        target: "Track",
                        priority: "Medium",
                        explanation: "Calculate and report savings achieved by AI vs manual. Break down by provider and scheme.",
                        example: "MTRH: 19.8% (480k)\nNHIF: 24.1% (376k)\nCounty: 18.5% (134k)\nTotal: 950k savings"
                    }
                ]
            }
        ];

        let currentFilter = 'all';

        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`${page}-page`).classList.add('active');
            event.target.classList.add('active');
            
            if (page === 'dashboard') {
                renderDashboard();
            }
        }

        function loadData() {
            const saved = localStorage.getItem('lctTrackerData');
            return saved ? JSON.parse(saved) : {};
        }

        function saveData() {
            const formData = {};
            checklistData.forEach(section => {
                section.items.forEach(item => {
                    const statusEl = document.getElementById(`status-${item.id}`);
                    const currentEl = document.getElementById(`current-${item.id}`);
                    const futureEl = document.getElementById(`future-${item.id}`);
                    const ownerEl = document.getElementById(`owner-${item.id}`);
                    const dateEl = document.getElementById(`date-${item.id}`);
                    
                    if (statusEl) {
                        formData[item.id] = {
                            status: statusEl.value,
                            currentCoverage: currentEl.value,
                            futurePlan: futureEl.value,
                            owner: ownerEl.value,
                            estDate: dateEl.value
                        };
                    }
                });
            });
            localStorage.setItem('lctTrackerData', JSON.stringify(formData));
            showToast('Saved');
            renderDashboard();
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function getStats() {
            const saved = loadData();
            let completed = 0, inProgress = 0, notStarted = 0, planned = 0, blocked = 0;
            const priorityCounts = { CRITICAL: 0, High: 0, Medium: 0, Low: 0 };
            const sectionStats = {};
            
            checklistData.forEach(section => {
                sectionStats[section.section] = { total: 0, completed: 0, inProgress: 0 };
                
                section.items.forEach(item => {
                    const status = saved[item.id]?.status || 'Not Started';
                    sectionStats[section.section].total++;
                    
                    if (status === 'Completed') {
                        completed++;
                        sectionStats[section.section].completed++;
                    } else if (status === 'In Progress') {
                        inProgress++;
                        sectionStats[section.section].inProgress++;
                    } else if (status === 'Planned') {
                        planned++;
                    } else if (status === 'Blocked') {
                        blocked++;
                    } else {
                        notStarted++;
                    }
                    
                    priorityCounts[item.priority]++;
                });
            });

            const total = completed + inProgress + planned + notStarted + blocked;
            const pct = total > 0 ? Math.round((completed / total) * 100) : 0;

            return { completed, inProgress, planned, notStarted, blocked, total, pct, priorityCounts, sectionStats };
        }

        function renderDashboard() {
            const stats = getStats();
            
            // Stats Cards
            document.getElementById('stats-cards').innerHTML = `
                <div class="stat-card total">
                    <div class="label">Total Items</div>
                    <div class="number">${stats.total}</div>
                </div>
                <div class="stat-card completed">
                    <div class="label">Completed</div>
                    <div class="number">${stats.completed}</div>
                    <div class="subtext">${Math.round((stats.completed/stats.total)*100)}% done</div>
                </div>
                <div class="stat-card progress">
                    <div class="label">In Progress</div>
                    <div class="number">${stats.inProgress}</div>
                    <div class="subtext">Active work</div>
                </div>
                <div class="stat-card planned">
                    <div class="label">Planned</div>
                    <div class="number">${stats.planned}</div>
                    <div class="subtext">Scheduled</div>
                </div>
                <div class="stat-card notstarted">
                    <div class="label">Not Started</div>
                    <div class="number">${stats.notStarted}</div>
                    <div class="subtext">Pending</div>
                </div>
                <div class="stat-card critical">
                    <div class="label">Critical</div>
                    <div class="number">${stats.priorityCounts.CRITICAL}</div>
                    <div class="subtext">High priority</div>
                </div>
                <div class="stat-card percentage">
                    <div class="label">Progress</div>
                    <div class="number">${stats.pct}%</div>
                    <div class="subtext">Overall</div>
                </div>
            `;
            
            // Progress Bar
            document.getElementById('progress-percentage').textContent = `${stats.pct}%`;
            document.getElementById('progress-fill').style.width = `${stats.pct}%`;
            
            // Priority Breakdown
            document.getElementById('priority-breakdown').innerHTML = `
                <div class="priority-item" style="border-left: 3px solid var(--error);">
                    <div class="count" style="color: var(--error);">${stats.priorityCounts.CRITICAL}</div>
                    <div class="label">Critical</div>
                </div>
                <div class="priority-item" style="border-left: 3px solid var(--warning);">
                    <div class="count" style="color: var(--warning);">${stats.priorityCounts.High}</div>
                    <div class="label">High</div>
                </div>
                <div class="priority-item" style="border-left: 3px solid var(--info);">
                    <div class="count" style="color: var(--info);">${stats.priorityCounts.Medium}</div>
                    <div class="label">Medium</div>
                </div>
                <div class="priority-item" style="border-left: 3px solid var(--info);">
                    <div class="count" style="color: var(--info);">${stats.priorityCounts.Low}</div>
                    <div class="label">Low</div>
                </div>
            `;
            
            // Section Breakdown
            let sectionHtml = '';
            Object.entries(stats.sectionStats).forEach(([name, data]) => {
                const pct = Math.round((data.completed / data.total) * 100);
                sectionHtml += `
                    <div class="section-item">
                        <div class="name">${name}</div>
                        <div class="stats">
                            <span>Total: ${data.total}</span>
                            <span style="color: var(--success);">Done: ${data.completed}</span>
                            <span style="color: var(--info);">Progress: ${data.inProgress}</span>
                            <span style="color: var(--accent);">${pct}%</span>
                        </div>
                    </div>
                `;
            });
            document.getElementById('section-breakdown').innerHTML = sectionHtml;
        }

        function filterItems(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderChecklist();
        }

        function toggleExplanation(id) {
            const el = document.getElementById(`explain-${id}`);
            const toggle = document.getElementById(`toggle-${id}`);
            el.classList.toggle('show');
            toggle.textContent = el.classList.contains('show') ? '‚ñº Hide details' : '‚ñ∂ Show details';
        }

        function toggleFields(itemId, status) {
            const current = document.getElementById(`current-group-${itemId}`);
            if (current) {
                if (status === 'Not Started') {
                    current.classList.add('hidden');
                } else {
                    current.classList.remove('hidden');
                }
            }
        }

        function renderChecklist() {
            const saved = loadData();
            const content = document.getElementById('checklist-content');
            let html = '';

            checklistData.forEach(section => {
                const filteredItems = section.items.filter(item => {
                    if (currentFilter === 'all') return true;
                    if (currentFilter === 'CRITICAL') return item.priority === 'CRITICAL';
                    const status = saved[item.id]?.status || 'Not Started';
                    return status === currentFilter;
                });

                if (filteredItems.length === 0) return;

                html += `<div class="section"><div class="section-title">${section.section}</div>`;

                filteredItems.forEach(item => {
                    const data = saved[item.id] || {};
                    const status = data.status || 'Not Started';
                    const showCurrent = status !== 'Not Started';
                    
                    html += `
                        <div class="item ${item.priority === 'CRITICAL' ? 'critical' : ''}">
                            <div class="item-header">
                                <div class="item-title">${item.criteria}</div>
                                <div class="badges">
                                    <span class="badge badge-${item.priority.toLowerCase()}">${item.priority}</span>
                                    <span class="badge" style="background:var(--muted);color:var(--text-secondary);border-color:var(--border)">${item.target}</span>
                                </div>
                            </div>
                            
                            <div class="explain-toggle" id="toggle-${item.id}" onclick="toggleExplanation(${item.id})">‚ñ∂ Show details</div>
                            
                            <div class="explanation" id="explain-${item.id}">
                                <div>${item.explanation}</div>
                                ${item.example ? `<div class="example">${item.example.replace(/\n/g, '<br>')}</div>` : ''}
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="status-${item.id}" onchange="toggleFields(${item.id}, this.value)">
                                        <option value="Not Started" ${status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                                        <option value="Planned" ${status === 'Planned' ? 'selected' : ''}>Planned</option>
                                        <option value="In Progress" ${status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                        <option value="Completed" ${status === 'Completed' ? 'selected' : ''}>Completed</option>
                                        <option value="Blocked" ${status === 'Blocked' ? 'selected' : ''}>Blocked</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Owner</label>
                                    <input type="text" id="owner-${item.id}" placeholder="Responsible person" value="${data.owner || ''}">
                                </div>
                                <div class="form-group">
                                    <label>Est. Date</label>
                                    <input type="date" id="date-${item.id}" value="${data.estDate || ''}">
                                </div>
                            </div>
                            
                            <div class="form-full">
                                <div class="form-group ${showCurrent ? '' : 'hidden'}" id="current-group-${item.id}">
                                    <label>Currently Covered</label>
                                    <textarea id="current-${item.id}" placeholder="What's implemented now">${data.currentCoverage || ''}</textarea>
                                </div>
                                <div class="form-group">
                                    <label>Future Plan</label>
                                    <textarea id="future-${item.id}" placeholder="When/how will this be done">${data.futurePlan || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            });

            content.innerHTML = html;
        }

        function exportJSON() {
            const formData = {};
            checklistData.forEach(section => {
                section.items.forEach(item => {
                    const statusEl = document.getElementById(`status-${item.id}`);
                    if (statusEl) {
                        formData[item.id] = {
                            section: section.section,
                            criteria: item.criteria,
                            target: item.target,
                            priority: item.priority,
                            status: statusEl.value,
                            currentCoverage: document.getElementById(`current-${item.id}`).value,
                            futurePlan: document.getElementById(`future-${item.id}`).value,
                            owner: document.getElementById(`owner-${item.id}`).value,
                            estDate: document.getElementById(`date-${item.id}`).value
                        };
                    }
                });
            });

            const dataStr = JSON.stringify(formData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `lct-tracker-${new Date().toISOString().split('T')[0]}.json`);
            link.click();
            showToast('Exported');
        }

        function exportCSV() {
            let csv = 'ID,Section,Criteria,Target,Priority,Status,Current,Future,Owner,Date\n';
            checklistData.forEach(section => {
                section.items.forEach(item => {
                    const statusEl = document.getElementById(`status-${item.id}`);
                    if (statusEl) {
                        const status = statusEl.value;
                        const current = document.getElementById(`current-${item.id}`).value.replace(/"/g, '""');
                        const future = document.getElementById(`future-${item.id}`).value.replace(/"/g, '""');
                        const owner = document.getElementById(`owner-${item.id}`).value;
                        const date = document.getElementById(`date-${item.id}`).value;
                        csv += `${item.id},"${section.section}","${item.criteria}","${item.target}","${item.priority}","${status}","${current}","${future}","${owner}","${date}"\n`;
                    }
                });
            });

            const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csv);
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', `lct-tracker-${new Date().toISOString().split('T')[0]}.csv`);
            link.click();
            showToast('Exported');
        }

        document.addEventListener('change', function(e) {
            if (e.target.tagName === 'SELECT' || e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                saveData();
            }
        });

        // Initialize
        renderDashboard();
        renderChecklist();
    </script>
</body>
</html>